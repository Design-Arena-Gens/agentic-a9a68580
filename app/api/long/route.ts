export const runtime = "edge";

function sleep(ms: number) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}

export async function GET() {
  const encoder = new TextEncoder();
  const parts = [
    "????? ??????? ? ????? ????? ?????? ?????? ???? ?????.\n\n",
    "?????: ???????. ?????? ?? ????? ??? ??? ????? ???? ??????? ??????? ??? ?????? ??? ???????.\n",
    "????? ??? ???? ???????? ???? ???? ?????? ???? ???????? ??? ?????? ?????? ?? ???.\n\n",
    "??????: ????????. ????? ??????? ??? ????? ?????? ?? ???? ?????? ?????? ??????: ???????? ??????? ???????? ?? ???????? ???????.\n",
    "??? ???? ??????? ???? ????? ????? ???????.\n\n",
    "??????: ???????. ?? ??? ???????? ???? ?????? ???? ?????? ?? ??????? ??? ????? ?????? ?????? ReadableStream?\n",
    "????? ????? ?????? ?? ??????? ???? ???? ?????? ?????? ??? ?? ???? ????? ????.\n\n",
    "??????: ???????. ?????? ???? ?? ??????? ????? ???????? ?? ?? ????? ?????? ???? ?????? ????? ????.\n",
    "????? ???? ??????? ?????? ?????? ?????? ????? ????? ??????? ????? ?????? ?????.\n\n",
    "??????: ????? ??????. ??? ???? ????? ?????? ??? ??? ?? ???? ????? ??????.\n"
  ];

  const stream = new ReadableStream<Uint8Array>({
    async start(controller) {
      for (const part of parts) {
        controller.enqueue(encoder.encode(part));
        await sleep(140);
      }
      controller.close();
    },
  });

  return new Response(stream, {
    headers: {
      "Content-Type": "text/plain; charset=utf-8",
      "Cache-Control": "no-store",
    },
  });
}
